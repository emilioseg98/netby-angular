<div class="max-w-6xl mx-auto p-6">
    <!-- Título -->
    <h1 class="text-3xl font-bold text-center text-gray-800 mb-6">Registro de Transacciones</h1>

    <!-- Botón de agregar producto -->
    <div class="flex justify-end mb-4">
        <div class="pt-2 relative mx-auto text-gray-600">

        </div>
        <button class="px-6 py-2 bg-blue-500 text-white font-semibold rounded-lg shadow-md hover:bg-blue-600 focus:outline-none" (click)="openModal()">
          Generar Transacción
        </button>
    </div>

    <!-- Tabla de productos -->
    <div class="overflow-x-auto bg-white shadow-md rounded-lg">
        <table class="min-w-full table-auto">
            <thead class="bg-gray-200">
                <tr>
                    <th class="px-4 py-2 text-left text-sm text-gray-600">ID</th>
                    <th class="px-4 py-2 text-left text-sm text-gray-600">Nombre Producto</th>
                    <th class="px-4 py-2 text-left text-sm text-gray-600">Tipo de Transacción</th>
                    <th class="px-4 py-2 text-left text-sm text-gray-600">Fecha de Compra</th>
                    <th class="px-4 py-2 text-left text-sm text-gray-600">Cantidad</th>
                    <th class="px-4 py-2 text-left text-sm text-gray-600">Precio Unitario</th>
                    <th class="px-4 py-2 text-left text-sm text-gray-600">Precio Total</th>
                    <th class="px-4 py-2 text-left text-sm text-gray-600">Detalle</th>
                    <th class="px-4 py-2 text-left text-sm text-gray-600">Acciones</th>
                </tr>
            </thead>
            <tbody id="transaccionesTable">
                @for(item of transacciones; track $index) {
                    <tr>
                        <td class="px-4 py-2 text-sm text-gray-700">{{item.id}}</td>
                        <td class="px-4 py-2 text-sm text-gray-700">{{item.producto.nombre}}</td>
                        <td class="px-4 py-2 text-sm text-gray-700">{{item.tipo_Transaccion}}</td>
                        <td class="px-4 py-2 text-sm text-gray-700">{{item.fecha_Compra}}</td>
                        <td class="px-4 py-2 text-sm text-gray-700">{{item.cantidad}}</td>
                        <td class="px-4 py-2 text-sm text-gray-700">{{item.precio_Unitario}}</td>
                        <td class="px-4 py-2 text-sm text-gray-700">{{item.precio_Total}}</td>
                        <td class="px-4 py-2 text-sm text-gray-700">{{item.detalle}}</td>
                        <td>
                            <!-- Botones de acción -->
                            <button class="px-4 py-1 bg-yellow-500 text-white rounded hover:bg-yellow-600" (click)="obtenerTransaccionFunc(item)">Editar</button>
                            <button class="px-4 py-1 bg-red-500 text-white rounded hover:bg-red-600" (click)="eliminarTransaccionFunc(item)">Eliminar</button>
                        </td>
                    </tr>
                }
            </tbody>
        </table>
        <div *ngIf="transacciones.length === 0" class="flex items-center justify-center h-20 bg-yellow-100 text-gray-500 text-lg font-medium rounded-lg shadow-inner">
            {{mensajeProductos}}
        </div>
    </div>

    <!-- Modal para agregar o editar producto -->
    <div 
        *ngIf="isModalOpen"
        class="fixed inset-0 z-50 overflow-y-auto"
        aria-labelledby="modal-title"
        role="dialog"
        aria-modal="true"
    >
        <div class="fixed inset-0 flex items-center justify-center bg-custom p-4">
            <div class="w-full max-w-md bg-white rounded-lg shadow-xl p-6 max-h-screen overflow-y-auto">
                <form (ngSubmit)="validarErrores()">
                    <div class="mb-4">
                        <mat-form-field>
                            <mat-label>Seleccionar un Producto</mat-label>
                            <mat-select [(ngModel)]="transaccionObj.producto" name="producto" [compareWith]="compareProducto">
                                <mat-option
                                    *ngFor="let cat of productos"
                                    [value]="cat"
                                >
                                    {{cat.nombre}}
                                </mat-option>
                            </mat-select>
                        </mat-form-field>
                        <div *ngIf="errors.producto">
                            <p class="text-sm font-normal text-red-700 mt-1">
                                {{errors.producto}}
                            </p>
                        </div>
                    </div>

                    <div class="mb-4">
                        <mat-form-field>
                            <mat-label>Fecha Compra</mat-label>
                            <input matInput [matDatepicker]="picker" [(ngModel)]="transaccionObj.fecha_Compra" name="fecha_Compra">
                            <mat-hint>MM/DD/YYYY</mat-hint>
                            <mat-datepicker-toggle matIconSuffix [for]="picker"></mat-datepicker-toggle>
                            <mat-datepicker #picker></mat-datepicker>
                        </mat-form-field>
                        <div *ngIf="errors.fecha_compra">
                            <p class="text-sm font-normal text-red-700 mt-1">
                                {{errors.fecha_compra}}
                            </p>
                        </div>
                    </div>

                    <div class="mb-4">
                        <mat-form-field>
                            <mat-label>Tipo de transacción</mat-label>
                            <mat-select [(ngModel)]="transaccionObj.tipo_Transaccion" name="tipo_Transaccion">
                                <mat-option
                                    *ngFor="let cat of tipo_transaccion"
                                    [value]="cat"
                                >
                                    {{cat}}
                                </mat-option>
                            </mat-select>
                        </mat-form-field>
                        <div *ngIf="errors.tipo_transaccion">
                            <p class="text-sm font-normal text-red-700 mt-1">
                                {{errors.tipo_transaccion}}
                            </p>
                        </div>
                    </div>

                    <div class="mb-4">
                        <label for="stock" class="block text-sm font-medium text-gray-700">Cantidad</label>
                        <input type="number" [(ngModel)]="transaccionObj.cantidad" id="cantidad" name="cantidad"
                            class="w-full px-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                            required>
                        <div *ngIf="errors.cantidad">
                            <p class="text-sm font-normal text-red-700 mt-1">
                                {{errors.cantidad}}
                            </p>
                        </div>
                    </div>

                    <div class="mb-4">
                        <label for="stock" class="block text-sm font-medium text-gray-700">Precio Unitario</label>
                        <input type="number" [(ngModel)]="transaccionObj.precio_Unitario" id="precio_Unitario" name="precio_Unitario"
                            class="w-full px-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                            required>
                        <div *ngIf="errors.precio_unitario">
                            <p class="text-sm font-normal text-red-700 mt-1">
                                {{errors.precio_unitario}}
                            </p>
                        </div>
                    </div>

                    <div class="mb-4">
                        <label for="stock" class="block text-sm font-medium text-gray-700">Precio Total</label>
                        <input type="number" 
                            [value]="transaccionObj.cantidad * transaccionObj.precio_Unitario || 0"
                        id="precio_Total" name="precio_Total" disabled={{true}}
                            class="w-full px-4 py-2 border border-gray-300 rounded-md bg-gray-300 text-gray-900 font-semibold
                                focus:outline-none focus:ring-0 focus:border-gray-300">
                        <div *ngIf="errors.precio_total">
                            <p class="text-sm font-normal text-red-700 mt-1">
                                {{errors.precio_total}}
                            </p>
                        </div>
                    </div>

                    <div class="mb-4">
                        <label for="detalle" class="block text-sm font-medium text-gray-700">Descripción</label>
                        <textarea id="detalle" [(ngModel)]="transaccionObj.detalle" name="detalle"
                            class="w-full px-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"></textarea>
                        <div *ngIf="errors.detalle">
                            <p class="text-sm font-normal text-red-700 mt-1">
                                {{errors.detalle}}
                            </p>
                        </div>
                    </div>

                    <div class="flex justify-end">
                        <button type="submit" class="px-6 py-2 bg-green-500 text-white font-semibold rounded-lg shadow-md hover:bg-green-600 focus:outline-none">Guardar</button>
                        <button type="button" id="closeModalButton" class="px-6 py-2 bg-gray-500 text-white font-semibold rounded-lg shadow-md hover:bg-gray-600 focus:outline-none ml-4" (click)="closeModal()">Cancelar</button>
                    </div>
                </form>
            </div>
        </div>

        <div 
            *ngIf="isModalConfirmationOpen"
            class="fixed inset-0 z-50 overflow-y-auto"
            aria-labelledby="modal-title"
            role="dialog"
            aria-modal="true"
            >
            <div class="fixed inset-0 flex items-center justify-center bg-custom p-4">
                <div class="bg-white rounded-2xl shadow-xl p-6 w-full max-w-sm">
                <h2 class="text-xl font-semibold mb-4 text-gray-800">{{this.isAviso ? 'Aviso' : 'Estás Seguro?'}}</h2>
                <p class="text-gray-600 mb-6">
                    {{this.isAviso ? mensajeEnvio : modalConfirmationSubMessage}}
                </p>
                <div class="flex justify-end space-x-4">
                    <button
                        (click)="this.closeModalConfirmation(false)"
                        class="px-4 py-2 bg-gray-200 text-gray-800 rounded-xl hover:bg-gray-300 transition"
                        >
                        {{this.isAviso ? 'OK!!' : 'Cancelar'}}
                    </button>
                    <button
                        *ngIf="!isAviso"
                            (click)="closeModalConfirmation(true)"
                            class="px-4 py-2 bg-red-600 text-white rounded-xl hover:bg-red-700 transition"
                        >
                            Confirmar
                    </button>
                </div>
                </div>
            </div>
            </div>
    </div>

    <div *ngIf="isModalConfirmationGlobalOpen" class="fixed inset-0 z-50 overflow-y-auto" aria-labelledby="modal-title"
        role="dialog" aria-modal="true">
        <div class="fixed inset-0 flex items-center justify-center bg-custom p-4">
            <div class="bg-white rounded-2xl shadow-xl p-6 w-full max-w-sm">
                <h2 class="text-xl font-semibold mb-4 text-gray-800">{{this.isAviso ? 'Aviso' : 'Estás Seguro?'}}</h2>
                <p class="text-gray-600 mb-6">
                    {{this.isAviso ? mensajeEnvio : modalConfirmationSubMessage}}
                </p>
                <div class="flex justify-end space-x-4">
                    <button (click)="this.closeModalConfirmationGlobal(false)"
                        class="px-4 py-2 bg-gray-200 text-gray-800 rounded-xl hover:bg-gray-300 transition">
                        {{this.isAviso ? 'OK!!' : 'Cancelar'}}
                    </button>
                    <button 
                        *ngIf="!isAviso"
                        (click)="this.closeModalConfirmationGlobal(true)"
                        class="px-4 py-2 bg-red-600 text-white rounded-xl hover:bg-red-700 transition">
                        Confirmar
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>